<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>RIYAS_MANIKODI_V21_MOBILE_SAFE</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/EffectComposer.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/RenderPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/ShaderPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/CopyShader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/LuminosityHighPassShader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/UnrealBloomPass.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/shaders/DigitalGlitch.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/postprocessing/GlitchPass.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/tween.js/18.6.4/tween.umd.js"></script>

    <style>
        :root {
            --primary: #0aff0a;
            /* Green */
            --secondary: #00f3ff;
            /* Blue */
            --tertiary: #ff0055;
            /* Pink */
            --accent: #ffcc00;
            /* Yellow */
            --dark-bg: #000000;
            --glass-panel: rgba(10, 20, 40, 0.7);
        }

        /* FIX: Use 100dvh to avoid mobile browser bars covering content */
        body {
            margin: 0;
            background: var(--dark-bg);
            color: #fff;
            font-family: 'Courier New', monospace;
            overflow: hidden;
            user-select: none;
            transition: 0.5s;
            height: 100dvh;
            width: 100vw;
        }

        canvas {
            display: block;
            position: fixed;
            inset: 0;
            z-index: 1;
            touch-action: none;
            outline: none;
        }

        .vignette {
            position: fixed;
            inset: 0;
            box-shadow: 0 0 200px rgba(0, 0, 0, 1) inset;
            pointer-events: none;
            z-index: 9998;
        }

        /* BOOT SCREEN */
        #boot-screen {
            position: fixed;
            inset: 0;
            background: #000;
            z-index: 5000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            pointer-events: auto;
        }

        .boot-text {
            font-size: 24px;
            color: var(--secondary);
            letter-spacing: 4px;
            margin-bottom: 20px;
            text-shadow: 0 0 15px var(--secondary);
            font-weight: bold;
            text-align: center;
        }

        #progress-wrap {
            width: 80%;
            max-width: 400px;
            height: 6px;
            background: #333;
            margin-top: 15px;
            position: relative;
        }

        #bar {
            width: 0%;
            height: 100%;
            background: var(--secondary);
            box-shadow: 0 0 20px var(--secondary);
        }

        /* MAIN UI LAYER (Use Dynamic Height) */
        .main-ui {
            display: none;
            opacity: 0;
            transition: opacity 2s ease;
            position: relative;
            z-index: 10;
            height: 100dvh;
            pointer-events: none;
        }

        /* HEADER */
        .header {
            position: absolute;
            top: 30px;
            width: 100%;
            text-align: center;
            pointer-events: none;
            transition: 0.5s;
        }

        .header h1 {
            font-size: 36px;
            letter-spacing: 6px;
            color: #fff;
            text-shadow: 0 0 15px var(--secondary);
            margin: 0;
        }

        .sub-header {
            font-size: 14px;
            color: var(--primary);
            letter-spacing: 3px;
            margin-top: 8px;
            font-weight: bold;
            text-shadow: 0 0 8px var(--primary);
        }

        /* CONTROLS */
        .top-controls {
            position: absolute;
            top: 30px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 40px;
            box-sizing: border-box;
            pointer-events: none;
            z-index: 100;
        }

        .ctrl-btn {
            border: 1px solid var(--secondary);
            color: var(--secondary);
            background: rgba(0, 0, 0, 0.8);
            padding: 8px 15px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            pointer-events: auto;
            transition: 0.3s;
            text-transform: uppercase;
            backdrop-filter: blur(5px);
        }

        .ctrl-btn.right {
            border-color: var(--accent);
            color: var(--accent);
        }

        .ctrl-btn:hover {
            background: #fff;
            color: #000;
            text-shadow: none;
            border-color: #fff;
        }

        /* DROPDOWNS */
        .dropdown-panel {
            position: absolute;
            top: 70px;
            padding: 20px;
            background: var(--glass-panel);
            backdrop-filter: blur(10px);
            pointer-events: auto;
            opacity: 0;
            visibility: hidden;
            transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translateY(-10px);
            z-index: 99;
            min-width: 220px;
        }

        .dropdown-panel.open {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        #config-panel {
            left: 40px;
            border: 1px solid var(--secondary);
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.2);
        }

        #audio-panel {
            right: 40px;
            border: 1px solid var(--accent);
            box-shadow: 0 0 15px rgba(255, 204, 0, 0.2);
        }

        .panel-title {
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            padding-bottom: 5px;
            color: #fff;
            letter-spacing: 2px;
        }

        .radio-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            cursor: pointer;
            font-size: 12px;
            color: #aaa;
            transition: 0.3s;
        }

        .radio-item input {
            margin-right: 10px;
            accent-color: currentColor;
        }

        .radio-item input:checked+span {
            font-weight: bold;
            color: #fff;
            text-shadow: 0 0 8px currentColor;
        }

        /* SIDE PANEL (PC) */
        .side-panel {
            position: absolute;
            left: 5%;
            top: 25%;
            width: 500px;
            max-width: 85%;
            padding: 30px;
            background: var(--glass-panel);
            border-left: 4px solid var(--secondary);
            box-shadow: 0 0 40px rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(10px);
            transition: 0.5s;
            pointer-events: auto;
        }

        .section-title {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 20px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.3);
            padding-bottom: 8px;
            letter-spacing: 2px;
        }

        .data-list {
            list-style: none;
            padding: 0;
            margin: 0;
            font-size: 16px;
            line-height: 1.6;
            color: #ddd;
        }

        .data-list li {
            margin-bottom: 10px;
            display: flex;
            flex-wrap: wrap;
        }

        .cursor-blink {
            display: inline-block;
            width: 8px;
            height: 18px;
            background: currentColor;
            margin-left: 5px;
            animation: blink 0.8s infinite;
        }

        @keyframes blink {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0;
            }
        }

        .data-content {
            display: none;
        }

        .data-content.active {
            display: block;
        }

        .cyber-form {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-top: 20px;
            opacity: 0;
            animation: fadeIn 1s forwards 0.5s;
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
            }
        }

        .form-row {
            display: flex;
            gap: 10px;
        }

        .cyber-input {
            background: rgba(0, 0, 0, 0.6);
            border: 1px solid var(--tertiary);
            color: #fff;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            width: 100%;
            transition: 0.3s;
        }

        .cyber-input:focus {
            outline: none;
            box-shadow: 0 0 10px var(--tertiary);
            background: rgba(255, 0, 85, 0.1);
        }

        .cyber-textarea {
            resize: none;
            height: 80px;
        }

        .cyber-btn {
            background: rgba(255, 0, 85, 0.2);
            color: var(--tertiary);
            border: 1px solid var(--tertiary);
            padding: 10px;
            font-weight: bold;
            cursor: pointer;
            text-transform: uppercase;
            font-family: 'Courier New', monospace;
            transition: 0.3s;
            font-size: 12px;
            letter-spacing: 1px;
        }

        .cyber-btn:hover {
            background: var(--tertiary);
            color: #000;
            box-shadow: 0 0 20px var(--tertiary);
        }

        .git-link {
            display: inline-block;
            margin-top: 20px;
            color: var(--secondary);
            text-decoration: none;
            font-size: 12px;
            font-weight: bold;
            border: 2px solid var(--secondary);
            padding: 10px 15px;
            transition: 0.3s;
            opacity: 0;
            pointer-events: auto;
        }

        .git-link:hover {
            background: var(--secondary);
            color: #000;
            box-shadow: 0 0 15px var(--secondary);
        }

        /* NAV BAR (PC) */
        .nav-bar {
            position: absolute;
            bottom: 40px;
            width: 100%;
            display: flex;
            justify-content: center;
            pointer-events: auto;
            transition: 0.5s;
            z-index: 101;
        }

        .nav-radio-group {
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid #555;
            padding: 12px 25px;
            display: flex;
            gap: 25px;
            border-radius: 4px;
            backdrop-filter: blur(5px);
        }

        .nav-radio-group label {
            cursor: pointer;
            font-size: 14px;
            color: #888;
            font-weight: bold;
            transition: 0.3s;
            display: flex;
            align-items: center;
        }

        .nav-radio-group input {
            margin-right: 8px;
            accent-color: var(--secondary);
            transform: scale(1.2);
        }

        .nav-radio-group label:hover {
            color: #fff;
        }

        .nav-radio-group input:checked+span {
            color: var(--secondary);
            text-shadow: 0 0 10px var(--secondary);
        }

        /* --- MOBILE LAYOUT FIXES (IMPORTANT) --- */
        body.mode-mobile .header {
            top: 60px;
            pointer-events: none;
        }

        body.mode-mobile .header h1 {
            font-size: 24px;
        }

        body.mode-mobile .sub-header {
            display: none;
        }

        body.mode-mobile .top-controls {
            padding: 0 15px;
            top: 15px;
        }

        body.mode-mobile .ctrl-btn {
            font-size: 10px;
            padding: 8px 10px;
        }

        body.mode-mobile #config-panel {
            left: 15px;
            width: 180px;
        }

        body.mode-mobile #audio-panel {
            right: 15px;
            width: 160px;
        }

        body.mode-mobile .side-panel {
            top: auto;
            /* Fix: Raise the panel so it doesn't push down the nav bar */
            bottom: 120px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            height: auto;
            max-height: 40vh;
            /* Prevent overflowing */
            overflow-y: auto;
            padding: 20px;
            background: rgba(5, 10, 15, 0.9);
            border-left: 2px solid var(--secondary);
        }

        body.mode-mobile .section-title {
            font-size: 18px;
            margin-bottom: 10px;
        }

        body.mode-mobile .data-list {
            font-size: 13px;
        }

        body.mode-mobile .nav-bar {
            /* Fix: Stick to bottom, ensure padding covers Safe Area */
            position: absolute;
            bottom: 0;
            padding-bottom: max(25px, env(safe-area-inset-bottom));
            padding-top: 20px;
            width: 100%;
            left: 0;
            /* Add gradient background so buttons are always readable over debris */
            background: linear-gradient(to top, #000 50%, transparent 100%);
            z-index: 1000;
        }

        body.mode-mobile .nav-radio-group {
            padding: 10px 5px;
            gap: 10px;
            width: 95%;
            max-width: 400px;
            justify-content: center;
            flex-wrap: wrap;
            background: rgba(10, 20, 30, 0.95);
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
            border: 1px solid #333;
        }

        body.mode-mobile .nav-radio-group label span {
            font-size: 10px;
            letter-spacing: 1px;
        }

        body.mode-mobile .nav-radio-group input {
            transform: scale(1);
            margin-right: 4px;
        }

        /* Media Query for AUTO Detection - Applies Same Mobile Rules */
        @media (max-width: 768px) {
            body:not(.mode-pc) .header {
                top: 60px;
            }

            body:not(.mode-pc) .header h1 {
                font-size: 24px;
            }

            body:not(.mode-pc) .sub-header {
                display: none;
            }

            body:not(.mode-pc) .top-controls {
                padding: 0 15px;
                top: 15px;
            }

            body:not(.mode-pc) .ctrl-btn {
                font-size: 10px;
                padding: 8px 10px;
            }

            body:not(.mode-pc) #config-panel {
                left: 15px;
                width: 180px;
            }

            body:not(.mode-pc) #audio-panel {
                right: 15px;
                width: 160px;
            }

            body:not(.mode-pc) .side-panel {
                top: auto;
                bottom: 120px;
                left: 50%;
                transform: translateX(-50%);
                width: 90%;
                height: auto;
                max-height: 40vh;
                overflow-y: auto;
                padding: 20px;
                background: rgba(5, 10, 15, 0.9);
                border-left: 2px solid var(--secondary);
            }

            body:not(.mode-pc) .section-title {
                font-size: 18px;
                margin-bottom: 10px;
            }

            body:not(.mode-pc) .data-list {
                font-size: 13px;
            }

            body:not(.mode-pc) .nav-bar {
                bottom: 0;
                padding-bottom: max(25px, env(safe-area-inset-bottom));
                padding-top: 20px;
                width: 100%;
                left: 0;
                background: linear-gradient(to top, #000 50%, transparent 100%);
            }

            body:not(.mode-pc) .nav-radio-group {
                padding: 10px 5px;
                gap: 10px;
                width: 95%;
                max-width: 400px;
                justify-content: center;
                flex-wrap: wrap;
                background: rgba(10, 20, 30, 0.95);
                box-shadow: 0 0 15px rgba(0, 0, 0, 0.5);
                border: 1px solid #333;
            }

            body:not(.mode-pc) .nav-radio-group label span {
                font-size: 10px;
            }
        }
    </style>
</head>

<body>
    <div class="vignette"></div>

    <div id="boot-screen">
        <div class="boot-text">WARP_DRIVE_ENGAGED</div>
        <div id="progress-wrap">
            <div id="bar"></div>
        </div>
        <div style="color:#888; font-size: 12px; margin-top: 15px; letter-spacing: 2px;">ENTERING DEEP SPACE SECTOR V21
        </div>
    </div>

    <div class="main-ui" id="master-ui">
        <div class="top-controls">
            <button class="ctrl-btn" onclick="toggleMenu('config-panel')">[ SYSTEM_CONFIG ]</button>
            <button class="ctrl-btn right" onclick="toggleMenu('audio-panel')">[ AUDIO_CONFIG ]</button>
        </div>

        <div id="config-panel" class="dropdown-panel">
            <div class="panel-title" style="color:var(--secondary)">SYSTEM_SETTINGS</div>
            <label class="radio-item radio-green"><input type="radio" name="view" value="auto" checked
                    onclick="setLayout('auto')"><span>AUTO_DETECT</span></label>
            <label class="radio-item radio-green"><input type="radio" name="view" value="mobile"
                    onclick="setLayout('mobile')"><span>FORCE_MOBILE</span></label>
            <label class="radio-item radio-green"><input type="radio" name="view" value="pc"
                    onclick="setLayout('pc')"><span>FORCE_DESKTOP</span></label>
            <div class="panel-title" style="margin-top:20px; color:var(--secondary)">COLOR_THEME</div>
            <label class="radio-item radio-green"><input type="radio" name="theme" value="default" checked
                    onclick="setTheme('default')"><span>CYBER_DEFAULT</span></label>
            <label class="radio-item radio-green"><input type="radio" name="theme" value="matrix"
                    onclick="setTheme('matrix')"><span>MATRIX_GREEN</span></label>
            <label class="radio-item radio-green"><input type="radio" name="theme" value="retro"
                    onclick="setTheme('retro')"><span>RETRO_AMBER</span></label>
            <label class="radio-item radio-green"><input type="radio" name="theme" value="ice"
                    onclick="setTheme('ice')"><span>ICE_BLUE</span></label>
            <label class="radio-item radio-green"><input type="radio" name="theme" value="core"
                    onclick="setTheme('core')"><span>CORE_RED</span></label>
        </div>

        <div id="audio-panel" class="dropdown-panel">
            <div class="panel-title" style="color:var(--accent)">SFX_PROFILE</div>
            <label class="radio-item radio-yellow"><input type="radio" name="sfx" value="scifi" checked
                    onclick="previewSound('scifi')"><span>SCI-FI</span></label>
            <label class="radio-item radio-yellow"><input type="radio" name="sfx" value="mech"
                    onclick="previewSound('mech')"><span>MECHANICAL</span></label>
            <label class="radio-item radio-yellow"><input type="radio" name="sfx" value="retro"
                    onclick="previewSound('retro')"><span>RETRO</span></label>
            <label class="radio-item radio-yellow"><input type="radio" name="sfx" value="glitch"
                    onclick="previewSound('glitch')"><span>GLITCH</span></label>
            <label class="radio-item radio-yellow"><input type="radio" name="sfx"
                    value="silent"><span>SILENT</span></label>
            <div class="panel-subtitle" style="margin-top:10px; color:#888; font-size:11px; font-weight:bold;">
                AMBIENT_LOOP</div>
            <label class="radio-item radio-yellow"><input type="radio" name="amb" value="void"
                    onclick="setAmbience('void')"><span>VOID_HUM</span></label>
            <label class="radio-item radio-yellow"><input type="radio" name="amb" value="ship"
                    onclick="setAmbience('ship')"><span>STARSHIP</span></label>
            <label class="radio-item radio-yellow"><input type="radio" name="amb" value="wind"
                    onclick="setAmbience('wind')"><span>NEBULA_WIND</span></label>
            <label class="radio-item radio-yellow"><input type="radio" name="amb" value="data"
                    onclick="setAmbience('data')"><span>DATA_STREAM</span></label>
            <label class="radio-item radio-yellow"><input type="radio" name="amb" value="off" checked
                    onclick="setAmbience('off')"><span>SILENCE</span></label>
        </div>

        <div class="header">
            <h1>RIYAS MANIKODI</h1>
            <div class="sub-header">MCA GRADUATE | SYSTEM ADMIN | AR/VR DEV</div>
        </div>

        <div class="side-panel">
            <div id="c-creative" class="data-content">
                <div class="section-title" style="color:var(--primary);">CREATIVE_ENGINE</div>
                <ul class="data-list">
                    <li data-label="FOCUS" data-value="AR/VR & High-Fidelity 3D"></li>
                    <li data-label="EDUCATION" data-value="Monolith Research Labs"></li>
                    <li data-label="STACK" data-value="Unreal Engine 5, Blender, Maya"></li>
                    <li data-label="SPECIALTY" data-value="Facial Reconstruction"></li>
                </ul>
            </div>
            <div id="c-technical" class="data-content">
                <div class="section-title" style="color:var(--primary);">SYSTEM_ADMIN</div>
                <ul class="data-list">
                    <li data-label="ROLE" data-value="IT Support @ Sify Technologies"></li>
                    <li data-label="METRICS" data-value="500+ Tickets | 95% SLA"></li>
                    <li data-label="NETWORKING" data-value="DNS, DHCP, Firewalls, TCP/IP"></li>
                    <li data-label="ADMIN" data-value="Windows/Mac, User Provisioning"></li>
                </ul>
            </div>
            <div id="c-software" class="data-content active">
                <div class="section-title" style="color:var(--secondary);">DEV_MODULES</div>
                <ul class="data-list">
                    <li data-label="LANGUAGES" data-value="Python, JavaScript, Bash, SQL"></li>
                    <li data-label="WEB" data-value="React.js, HTML5, CSS3"></li>
                    <li data-label="PROJECT A" data-value="Video Steganography [Security]"></li>
                    <li data-label="PROJECT B" data-value="Farmer's E-Market [Full Stack]"></li>
                </ul>
                <a href="https://github.com/Riyasmanikodi" target="_blank" class="git-link"
                    onmouseenter="playHoverSound()">[ ACCESS GITHUB DATABASE ]</a>
            </div>
            <div id="c-contact" class="data-content">
                <div class="section-title" style="color:var(--tertiary);">COMM_LINK</div>
                <ul class="data-list">
                    <li data-label="STATUS" data-value="Online & Available"></li>
                    <li data-label="LOCATION" data-value="Tamil Nadu, India"></li>
                </ul>
                <form action="https://formspree.io/f/mnneyevy" method="POST" class="cyber-form">
                    <div class="form-row">
                        <input type="text" name="name" class="cyber-input" placeholder="> AGENT_NAME" required
                            onfocus="playHoverSound()">
                        <input type="email" name="email" class="cyber-input" placeholder="> COMM_CHANNEL (EMAIL)"
                            required onfocus="playHoverSound()">
                    </div>
                    <input type="text" name="subject" class="cyber-input" placeholder="> SUBJECT_LINE" required
                        onfocus="playHoverSound()">
                    <textarea name="message" class="cyber-input cyber-textarea" placeholder="> TRANSMISSION_DATA..."
                        required onfocus="playHoverSound()"></textarea>
                    <button type="submit" class="cyber-btn" onmouseenter="playHoverSound()">[ EXECUTE SEND_PROTOCOL
                        ]</button>
                </form>
            </div>
        </div>

        <div class="nav-bar">
            <div class="nav-radio-group">
                <label onmouseenter="playHoverSound()"><input type="radio" name="main-nav" value="creative"
                        onclick="loadProject('creative', 'INTERNAL')"><span>CREATIVE</span></label>
                <label onmouseenter="playHoverSound()"><input type="radio" name="main-nav" value="technical"
                        onclick="loadProject('technical', 'INTERNAL')"><span>TECHNICAL</span></label>
                <label onmouseenter="playHoverSound()"><input type="radio" name="main-nav" value="software" checked
                        onclick="loadProject('software', 'INTERNAL')"><span>SOFTWARE</span></label>
                <label onmouseenter="playHoverSound()"><input type="radio" name="main-nav" value="contact"
                        onclick="loadProject('contact', 'INTERNAL')"><span>CONTACT</span></label>
            </div>
        </div>
    </div>

    <canvas id="stage"></canvas>

    <script>
        let audioCtx;
        let ambientNode = null, ambientGain = null;
        let lastOut = 0;

        window.addEventListener('click', () => {
            if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            if (audioCtx.state === 'suspended') audioCtx.resume();
        }, { once: true });

        // KEYBOARD SHORTCUTS
        window.addEventListener('keydown', (e) => {
            if (e.key === '1') document.querySelector('input[value="creative"]').click();
            if (e.key === '2') document.querySelector('input[value="technical"]').click();
            if (e.key === '3') document.querySelector('input[value="software"]').click();
            if (e.key === '4') document.querySelector('input[value="contact"]').click();
        });

        function toggleMenu(id) {
            const el = document.getElementById(id);
            const isOpen = el.classList.contains('open');
            document.querySelectorAll('.dropdown-panel').forEach(p => p.classList.remove('open'));
            if (!isOpen) el.classList.add('open');
            playHoverSound();
        }

        // --- AMBIENT SOUND GENERATOR ---
        function setAmbience(type) {
            if (!audioCtx) return;
            if (ambientGain) { ambientGain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 1); setTimeout(() => { if (ambientGain) ambientGain.disconnect(); }, 1000); }
            if (ambientNode) { const old = ambientNode; setTimeout(() => { if (old) old.stop(); }, 1000); }
            if (type === 'off') return;

            const bufferSize = audioCtx.sampleRate * 2;
            const buffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
            const data = buffer.getChannelData(0);

            for (let i = 0; i < bufferSize; i++) {
                const white = Math.random() * 2 - 1;
                if (type === 'void') { data[i] = (lastOut + (0.02 * white)) / 1.02; lastOut = data[i]; data[i] *= 3.5; }
                else if (type === 'ship') { data[i] = 0; }
                else if (type === 'wind') { data[i] = (lastOut + (0.1 * white)) / 1.1; lastOut = data[i]; }
                else { data[i] = Math.random() < 0.1 ? Math.random() * 0.5 : 0; }
            }

            let source;
            if (type === 'ship') { source = audioCtx.createOscillator(); source.type = 'sawtooth'; source.frequency.value = 60; }
            else { source = audioCtx.createBufferSource(); source.buffer = buffer; source.loop = true; }

            const gain = audioCtx.createGain(); gain.gain.value = 0.001;
            const filter = audioCtx.createBiquadFilter();
            if (type === 'void') { filter.type = 'lowpass'; filter.frequency.value = 200; }
            else if (type === 'ship') { filter.type = 'lowpass'; filter.frequency.value = 120; }
            else if (type === 'wind') { filter.type = 'highpass'; filter.frequency.value = 600; }
            else { filter.type = 'allpass'; }

            source.connect(filter); filter.connect(gain); gain.connect(audioCtx.destination);
            source.start(); gain.gain.exponentialRampToValueAtTime(0.15, audioCtx.currentTime + 2);
            ambientNode = source; ambientGain = gain;
        }

        function playTone(freq, type, duration, vol = 0.05) {
            if (!audioCtx || audioCtx.state === 'suspended') return;
            const osc = audioCtx.createOscillator(); const gain = audioCtx.createGain();
            osc.type = type; osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
            gain.gain.setValueAtTime(vol, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + duration);
            osc.connect(gain); gain.connect(audioCtx.destination);
            osc.start(); osc.stop(audioCtx.currentTime + duration);
        }

        function getProfile() { const r = document.getElementsByName('sfx'); for (let i of r) if (i.checked) return i.value; return 'scifi'; }
        function previewSound(p) { playTypingSound(p); }
        function playHoverSound() { playTone(1200, 'sine', 0.05); }
        function playTypingSound(force = null) {
            const p = force || getProfile();
            if (p === 'silent') return;
            if (p === 'mech') playTone(150 + Math.random() * 50, 'square', 0.05, 0.04);
            else if (p === 'scifi') playTone(800 + Math.random() * 200, 'sine', 0.05, 0.05);
            else if (p === 'retro') playTone(200 + Math.random() * 100, 'sawtooth', 0.08, 0.03);
            else if (p === 'glitch') playGlitchSound();
        }

        function playGlitchSound() {
            if (!audioCtx) return;
            const b = audioCtx.createBuffer(1, audioCtx.sampleRate * 0.05, audioCtx.sampleRate);
            const d = b.getChannelData(0); for (let i = 0; i < d.length; i++) d[i] = Math.random() * 2 - 1;
            const s = audioCtx.createBufferSource(); const g = audioCtx.createGain();
            s.buffer = b; g.gain.value = 0.05; s.connect(g); g.connect(audioCtx.destination); s.start();
        }

        function setLayout(mode) {
            document.body.classList.remove('mode-mobile', 'mode-pc');
            if (mode === 'mobile') document.body.classList.add('mode-mobile');
            if (mode === 'pc') document.body.classList.add('mode-pc');
            playHoverSound();
            window.dispatchEvent(new Event('resize'));
        }

        function setTheme(theme) {
            const root = document.documentElement;
            if (theme === 'default') { root.style.setProperty('--primary', '#0aff0a'); root.style.setProperty('--secondary', '#00f3ff'); root.style.setProperty('--tertiary', '#ff0055'); }
            else if (theme === 'matrix') { root.style.setProperty('--primary', '#00ff00'); root.style.setProperty('--secondary', '#00dd00'); root.style.setProperty('--tertiary', '#00aa00'); }
            else if (theme === 'retro') { root.style.setProperty('--primary', '#ffaa00'); root.style.setProperty('--secondary', '#ff8800'); root.style.setProperty('--tertiary', '#cc6600'); }
            else if (theme === 'ice') { root.style.setProperty('--primary', '#00ffff'); root.style.setProperty('--secondary', '#00bbff'); root.style.setProperty('--tertiary', '#0088ff'); }
            else if (theme === 'core') { root.style.setProperty('--primary', '#ff0000'); root.style.setProperty('--secondary', '#ff4400'); root.style.setProperty('--tertiary', '#aa0000'); }
            playHoverSound();
            const activeId = document.querySelector('.data-content.active').id.replace('c-', '');
            loadProject(activeId, 'INTERNAL', true);
        }

        // --- THREE.JS ---
        const scene = new THREE.Scene(); scene.fog = new THREE.FogExp2(0x000000, 0.015);
        const camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 0.1, 2000); camera.position.z = 8;
        const renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('stage'), antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        const composer = new THREE.EffectComposer(renderer); composer.addPass(new THREE.RenderPass(scene, camera));
        const bloom = new THREE.UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 1.5, 0.4, 0.85); bloom.strength = 1.8; composer.addPass(bloom);
        const glitch = new THREE.GlitchPass(); glitch.enabled = false; composer.addPass(glitch);
        const controls = new THREE.OrbitControls(camera, renderer.domElement); controls.enableDamping = true; controls.dampingFactor = 0.05; controls.autoRotate = true; controls.autoRotateSpeed = 0.5;

        scene.add(new THREE.AmbientLight(0x404040, 1.5));
        const dirLight = new THREE.DirectionalLight(0xffffff, 1); dirLight.position.set(5, 10, 7); scene.add(dirLight);
        const accentLight = new THREE.PointLight(0x00f3ff, 2, 50); accentLight.position.set(-5, 2, 5); scene.add(accentLight);

        // VISUALS
        const bhGroup = new THREE.Group(); bhGroup.position.z = -50; scene.add(bhGroup);
        const horizon = new THREE.Mesh(new THREE.SphereGeometry(10, 32, 32), new THREE.MeshBasicMaterial({ color: 0x000000 })); bhGroup.add(horizon);
        const diskGeo = new THREE.RingGeometry(12, 25, 64);
        const diskMat = new THREE.MeshBasicMaterial({ color: 0xff0055, side: THREE.DoubleSide, transparent: true, opacity: 0.8 });
        const disk = new THREE.Mesh(diskGeo, diskMat); disk.rotation.x = Math.PI / 1.5; bhGroup.add(disk);

        const starsGeo = new THREE.BufferGeometry();
        const starCount = 3000;
        const starPos = new Float32Array(starCount * 3);
        const starSpeeds = new Float32Array(starCount);
        for (let i = 0; i < starCount; i++) {
            starPos[i * 3] = (Math.random() - 0.5) * 400; starPos[i * 3 + 1] = (Math.random() - 0.5) * 400; starPos[i * 3 + 2] = (Math.random() - 0.5) * 600;
            starSpeeds[i] = Math.random() * 0.5 + 0.1;
        }
        starsGeo.setAttribute('position', new THREE.BufferAttribute(starPos, 3));
        const starsMat = new THREE.PointsMaterial({ color: 0xffffff, size: 0.5, transparent: true, opacity: 0.8 });
        const starField = new THREE.Points(starsGeo, starsMat); scene.add(starField);

        const debrisGroup = new THREE.Group();
        const rockGeo = new THREE.DodecahedronGeometry(0.5, 0);
        const rockMat = new THREE.MeshStandardMaterial({ color: 0x555555, roughness: 0.8, flatShading: true });
        for (let i = 0; i < 50; i++) {
            const rock = new THREE.Mesh(rockGeo, rockMat);
            rock.position.set((Math.random() - 0.5) * 30, (Math.random() - 0.5) * 30, (Math.random() - 0.5) * 20);
            rock.rotation.set(Math.random() * Math.PI, Math.random() * Math.PI, 0);
            rock.userData = { rotSpeed: { x: Math.random() * 0.02, y: Math.random() * 0.02 }, drift: { x: (Math.random() - 0.5) * 0.01, y: (Math.random() - 0.5) * 0.01 } };
            debrisGroup.add(rock);
        }
        scene.add(debrisGroup);

        let currentModel = null, animObjs = [], typingTimeouts = [], isWarping = false;
        const mouse = new THREE.Vector2();
        document.addEventListener('mousemove', (e) => { mouse.x = (e.clientX / window.innerWidth) * 2 - 1; mouse.y = -(e.clientY / window.innerHeight) * 2 + 1; });

        async function boot() {
            const bar = document.getElementById('bar');
            for (let i = 0; i <= 100; i += 2) { bar.style.width = i + '%'; await new Promise(r => setTimeout(r, 10)); }
            document.getElementById('boot-screen').style.display = 'none';
            document.getElementById('master-ui').style.display = 'block';
            setTimeout(() => document.getElementById('master-ui').style.opacity = '1', 100);
            document.querySelector('input[name="main-nav"][value="software"]').checked = true;
            loadProject('software', 'INTERNAL');
        }

        function loadProject(id, file, skipGlitch = false) {
            if (!skipGlitch) { glitch.enabled = true; playGlitchSound(); isWarping = true; setTimeout(() => { glitch.enabled = false; isWarping = false; }, 500); }
            document.querySelectorAll('.dropdown-panel').forEach(p => p.classList.remove('open'));
            document.querySelectorAll('.data-content').forEach(d => d.classList.remove('active'));
            document.getElementById('c-' + id).classList.add('active');
            typeWriter('c-' + id);

            const style = getComputedStyle(document.documentElement);
            const pri = style.getPropertyValue('--primary').trim();
            const sec = style.getPropertyValue('--secondary').trim();
            const ter = style.getPropertyValue('--tertiary').trim();
            let c = (id === 'software') ? new THREE.Color(sec) : (id === 'contact') ? new THREE.Color(ter) : new THREE.Color(pri);

            accentLight.color = c; disk.material.color = c; starsMat.color = c; bloom.strength = (id === 'software' || id === 'contact') ? 2.0 : 1.5;

            if (currentModel) { new TWEEN.Tween(currentModel.scale).to({ x: 0, y: 0, z: 0 }, 300).easing(TWEEN.Easing.Back.In).onComplete(() => { scene.remove(currentModel); createModel(id, c); }).start(); } else { createModel(id, c); }
        }

        function typeWriter(id) {
            typingTimeouts.forEach(t => clearTimeout(t)); typingTimeouts = [];
            const container = document.getElementById(id);
            const lis = container.querySelectorAll('li');
            const link = container.querySelector('.git-link');
            const style = getComputedStyle(document.documentElement);
            const pri = style.getPropertyValue('--primary').trim();
            const sec = style.getPropertyValue('--secondary').trim();
            const ter = style.getPropertyValue('--tertiary').trim();
            const cVar = id.includes('contact') ? ter : id.includes('software') ? sec : pri;

            lis.forEach(li => li.innerHTML = '');
            if (link) link.style.opacity = '0';

            let delay = 0;
            lis.forEach(li => {
                const lbl = li.getAttribute('data-label'); const val = li.getAttribute('data-value');
                typingTimeouts.push(setTimeout(() => {
                    li.innerHTML = `<span style="color:${cVar}; margin-right:8px;">> <b>${lbl}:</b></span><span class="txt"></span><span class="cursor-blink">â–ˆ</span>`;
                    let idx = 0; const span = li.querySelector('.txt');
                    function type() { if (idx < val.length) { span.textContent += val.charAt(idx); idx++; if (idx % 3 === 0) playTypingSound(); typingTimeouts.push(setTimeout(type, 20)); } else { const c = li.querySelector('.cursor-blink'); if (c) c.style.display = 'none'; } }
                    type();
                }, delay));
                delay += (val.length * 20) + 300;
            });
            if (link) typingTimeouts.push(setTimeout(() => { link.style.transition = 'opacity 1s'; link.style.opacity = '1'; }, delay));
        }

        function createModel(type, color) {
            const grp = new THREE.Group(); animObjs = [];
            if (type === 'creative') {
                const geo = new THREE.TorusKnotGeometry(1, 0.3, 100, 16); const mat = new THREE.MeshStandardMaterial({ color: color, wireframe: true, roughness: 0.1, metalness: 1, emissive: color, emissiveIntensity: 0.4 });
                grp.add(new THREE.Mesh(geo, mat));
                const shell = new THREE.Mesh(new THREE.TorusKnotGeometry(1.2, 0.4, 64, 16), new THREE.MeshBasicMaterial({ color: color, wireframe: true, transparent: true, opacity: 0.05 }));
                grp.add(shell); animObjs.push({ mesh: shell, speed: -0.01 });
            } else if (type === 'technical') {
                const mat = new THREE.MeshStandardMaterial({ color: 0x222222 }); const wMat = new THREE.MeshBasicMaterial({ color: color, wireframe: true, opacity: 0.3, transparent: true });
                const box = new THREE.BoxGeometry(1.5, 2.5, 1.5); grp.add(new THREE.Mesh(box, mat)); grp.add(new THREE.Mesh(box, wMat));
                for (let i = 0; i < 8; i++) { const l = new THREE.Mesh(new THREE.SphereGeometry(0.05), new THREE.MeshBasicMaterial({ color: color })); l.position.set(0.76, (Math.random() - 0.5) * 2, (Math.random() - 0.5) * 1); grp.add(l); animObjs.push({ mesh: l, type: 'blink', speed: Math.random() * 0.1 + 0.05, off: Math.random() * 10 }); }
            } else if (type === 'software') {
                const core = new THREE.Mesh(new THREE.IcosahedronGeometry(1, 0), new THREE.MeshStandardMaterial({ color: color, flatShading: true, metalness: 0.9, emissive: color, emissiveIntensity: 0.2 }));
                const ring = new THREE.Mesh(new THREE.TorusGeometry(1.5, 0.05, 16, 100), new THREE.MeshBasicMaterial({ color: color })); grp.add(core); grp.add(ring); animObjs.push({ mesh: core, type: 'pulse' }); animObjs.push({ mesh: ring, type: 'spin' });
            } else {
                const earth = new THREE.Mesh(new THREE.SphereGeometry(1.2, 32, 32), new THREE.MeshBasicMaterial({ color: color, wireframe: true, opacity: 0.3, transparent: true })); grp.add(earth); animObjs.push({ mesh: earth, speed: 0.005 });
            }
            scene.add(grp); currentModel = grp; grp.scale.set(0, 0, 0); new TWEEN.Tween(grp.scale).to({ x: 1, y: 1, z: 1 }, 1000).easing(TWEEN.Easing.Elastic.Out).start();
        }

        function animate() {
            requestAnimationFrame(animate); TWEEN.update(); controls.update();
            const t = Date.now() * 0.001;

            const pos = starField.geometry.attributes.position.array;
            for (let i = 0; i < starCount; i++) { let speed = isWarping ? starSpeeds[i] * 20 : starSpeeds[i]; pos[i * 3 + 2] += speed; if (pos[i * 3 + 2] > 20) pos[i * 3 + 2] = -200; }
            starField.geometry.attributes.position.needsUpdate = true; starField.scale.z = isWarping ? 20 : 1;

            debrisGroup.rotation.x = mouse.y * 0.1; debrisGroup.rotation.y = mouse.x * 0.1; bhGroup.rotation.x = mouse.y * 0.05; bhGroup.rotation.y = mouse.x * 0.05; disk.rotation.z -= 0.005;
            debrisGroup.children.forEach(rock => { rock.rotation.x += rock.userData.rotSpeed.x; rock.rotation.y += rock.userData.rotSpeed.y; rock.position.x += rock.userData.drift.x; if (rock.position.x > 15) rock.position.x = -15; if (rock.position.x < -15) rock.position.x = 15; });

            const isMobile = document.body.classList.contains('mode-mobile') || (window.innerWidth < 768 && !document.body.classList.contains('mode-pc'));
            if (isMobile) { if (currentModel) currentModel.position.y = 0.5; camera.position.y = 1; } else { if (currentModel) currentModel.position.y = 0; }

            if (currentModel) { currentModel.rotation.y += 0.003; animObjs.forEach(o => { if (o.type === 'blink') { const v = Math.sin(t * 10 * o.speed + o.off); o.mesh.visible = v > 0; } else if (o.type === 'pulse') { o.mesh.scale.setScalar(1 + Math.sin(t * 2) * 0.05); o.mesh.rotation.y -= 0.01; } else if (o.type === 'spin') { o.mesh.rotation.x += 0.02; o.mesh.rotation.y += 0.02; } else { o.mesh.rotation.y += o.speed; } }); }
            composer.render();
        }

        window.addEventListener('resize', () => { camera.aspect = window.innerWidth / window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth, window.innerHeight); composer.setSize(window.innerWidth, window.innerHeight); });

        boot(); animate();
    </script>
</body>

</html>
